/******************************************
 * 多子棋插件
 *
 * @作者 ：听涛设计
 * @版权 ：Copyright (c) 2013 听涛TinTao.
 * @网址 ：http://www.saecn.com
 * @更新 : 2013-05-08
 * @版本 ：Version 0.1.1
 *
 ******************************************/
(function(e){function t(e,t){return this.settings=e,this.$elem=t,this.flag=!0,this.b_QiZi=0,this.w_QiZi=0,this.times=0,this.historyStep="",this.dispalyVal="黑子方先手",this.allQiZi=e.zHang*e.zLie,this.tableWidth=e.zLie*50,this.tableHeight=e.zHang*50,this}e.fn.wzGame=function(n,r){if(typeof n=="object")r=n;else if(typeof n=="string"){var i=[],s=this.each(function(){var t=e(this).data("_wzGame");t&&e.fn.wzGame.defaultSettings[n]!==undefined&&(r!==undefined?t.settings[n]=r:i.push(t.settings[n]))});return i.length===1?i[0]:i.length>0?i:s}return r=e.extend({},e.fn.wzGame.defaultSettings,r||{}),this.each(function(){var n=e(this),i=jQuery.extend(!0,{},r),s=new t(i,n);s.init(),n.data("_wzGame",s)})},e.fn.wzGame.defaultSettings={wzNum:5,zHang:10,zLie:10},t.prototype={init:function(){var t=this,n="<table><tr><td>";n+="<table align='center' border='1'  bgcolor='#ddddee'><tr><td>",n+="<table width='"+t.tableWidth+"' height='"+t.tableHeight+"' align='center' border='0' cellspacing='0' cellpadding='0'  bgcolor='#ccccdd'>";for(var r=1;r<=t.settings.zHang;r++){n+="<tr>";for(var i=1;i<=t.settings.zLie;i++)n+="<td>",n+="<div name = div_"+i+"_"+r+"  id = div_"+i+"_"+r+"_b class=td style= 'display:none; width:50px; height:50px' ><img src= image/black_.gif width=50 heigh=50 ></div>\n",n+="<div name = div_"+i+"_"+r+"  id = div_"+i+"_"+r+"_w class=td style= 'display:none; width:50px; height:50px' ><img src= image/white_.gif width=50 heigh=50 ></div>\n",n+="<div name = div_"+i+"_"+r+"  id = div_"+i+"_"+r+"_n class=td style= 'display:block; width:50px; height:50px' ><img src= image/null_.gif width=50 heigh=50 ></div>\n",n+="</td>";n+="</tr>"}n+="</table >",n+="</td></tr></table >",n+="</td><td valign=top><table border=1 width=300 height='"+t.tableHeight+"' bgcolor=#FFCC33><tr><td valign=top>",n+="<table width=100%  border=0  bgcolor=#FFCC33 ><tr><td width=40% align=center height=40><div style='font-size:20px; line-height:40px; background:#FFdd44' id=displayInfo></div></td></tr></tr><td width=20% align=center height=40><input type=button  value='悔　　棋' id=goback></td></tr></tr><td width=10% align=center height=40><input type=button  value=重新开始 id=reloadGame></td></tr></tr><td width=30% align=center height=40><input type=button  value=退出游戏 id=logout></td></tr></table></td></tr></table>",n+="</td></tr></table>",t.$elem.html(n),e("#displayInfo").html(this.dispalyVal),t.$elem.find(".td").bind("click",function(){var n=e(this).attr("name");if(t.historyStep.indexOf(n)>-1)return!1;if(t.flag){if(e(this).css("display")!="none")e("#"+n+"_b").css("display","block"),e("#"+n+"_w").css("display","none"),e("#"+n+"_n").css("display","none"),t.historyStep=t.historyStep+"="+n+"_b";else if(e("#"+n+"_w").css("display")!="none"||e("#"+n+"_b").css("display")!="none")return!1;t.b_QiZi++,t.checkWin(t,e("#"+n+"_b"),"black"),t.flag=!1,e("#displayInfo").html("白子方走棋，白子方已走"+t.w_QiZi+"步")}else{if(e(this).css("display")!="none")e("#"+n+"_w").css("display","block"),e("#"+n+"_b").css("display","none"),e("#"+n+"_n").css("display","none"),t.historyStep=t.historyStep+"="+n+"_w";else if(e("#"+n+"_w").css("display")!="none"||e("#"+n+"_b").css("display")!="none")return!1;t.w_QiZi++,t.checkWin(t,e("#"+n+"_w"),"white"),t.flag=!0,e("#displayInfo").html("黑子方走棋，黑子方已走"+t.b_QiZi+"步")}t.w_QiZi+t.b_QiZi>=t.allQiZi&&confirm("比赛结束了，双方平局！需要再来一局吗？")&&window.location.reload()}),e("#goback").click(function(){var n=t.historyStep.split("=");if(n.length<=1)return alert("不能再悔了"),!1;var r=n[n.length-1],i=e("#"+r);i.css("display","none");var s=t.historyStep.length-i.attr("id").length-1;t.historyStep=t.historyStep.substring(0,s),e(t.dispaly).val(" *黑子方*走棋* ");if(t.flag){var o=e("#"+r.toString().replace("w","n"));o.css("display","block"),t.w_QiZi--,e(t.dispaly).val(" *白子方*走棋* _已"+t.w_QiZi+"步"),t.flag=!1}else{var o=e("#"+r.toString().replace("b","n"));o.css("display","block"),t.b_QiZi--,e(t.dispaly).val(" *黑子方*走棋* _已"+t.b_QiZi+"步"),t.flag=!0}}),e("#logout").click(function(){window.close()}),e("#reloadGame").click(function(){t.reGame()})},checkWin:function(e,t,n){if(n=="white"){if(e.w_QiZi<e.settings.wzNum)return!1;this.checkWhoWin(e,t)}if(n=="black"){if(e.b_QiZi<e.settings.wzNum)return!1;this.checkWhoWin(e,t)}},checkWhoWin:function(e,t){var n,r,i,s,o=t.attr("id");n=o.split("_"),r=n[1],i=n[2],s=n[3],this.checkXY(e,r,i,s)},checkXY:function(e,t,n,r){e.times=0;var i=!1;i||(e.times=this.checkXY_left(e,t,n,r,e.times),i=this.whoWin(e,r)),i||(e.times=this.checkXY_right(e,t,n,r,e.times),i=this.whoWin(e,r)),e.times=0,i||(e.times=this.checkXY_left_up(e,t,n,r,e.times),i=this.whoWin(e,r)),i||(e.times=this.checkXY_right_down(e,t,n,r,e.times),i=this.whoWin(e,r)),e.times=0,i||(e.times=this.checkXY_up(e,t,n,r,e.times),i=this.whoWin(e,r)),i||(e.times=this.checkXY_down(e,t,n,r,e.times),i=this.whoWin(e,r)),e.times=0,i||(e.times=this.checkXY_right_up(e,t,n,r,e.times),i=this.whoWin(e,r)),i||(e.times=this.checkXY_left_down(e,t,n,r,e.times),i=this.whoWin(e,r))},checkXY_left:function(t,n,r,i,s){n=Number(n),r=Number(r);for(var o=n-1;o>0;o--){if(e("#div_"+o+"_"+r+"_"+i).css("display")!="block")break;s++}return s},checkXY_right:function(t,n,r,i,s){n=Number(n),r=Number(r);for(var o=n+1;o<=t.settings.zLie;o++){if(e("#div_"+o+"_"+r+"_"+i).css("display")!="block")break;s++}return s},checkXY_left_up:function(t,n,r,i,s){n=Number(n),r=Number(r);var o=r-1;for(var u=n-1;u>0;u--){if(o>0){if(e("#div_"+u+"_"+o+"_"+i).css("display")!="block")break;s++}o--}return s},checkXY_right_down:function(t,n,r,i,s){n=Number(n),r=Number(r);var o=r+1;for(var u=n+1;u<=t.settings.zLie;u++){if(o<=t.settings.zLie){if(e("#div_"+u+"_"+o+"_"+i).css("display")!="block")break;s++}o++}return s},checkXY_up:function(t,n,r,i,s){n=Number(n),r=Number(r);for(var o=r-1;o>0;o--){if(e("#div_"+n+"_"+o+"_"+i).css("display")!="block")break;s++}return s},checkXY_down:function(t,n,r,i,s){n=Number(n),r=Number(r);for(var o=r+1;o<=t.settings.zHang;o++){if(e("#div_"+n+"_"+o+"_"+i).css("display")!="block")break;s++}return s},checkXY_right_up:function(t,n,r,i,s){n=Number(n),r=Number(r);var o=r-1;for(var u=n+1;u<=t.settings.zLie;u++){if(o>0){if(e("#div_"+u+"_"+o+"_"+i).css("display")!="block")break;s++}o--}return s},checkXY_left_down:function(t,n,r,i,s){n=Number(n),r=Number(r);var o=r+1;for(var u=n-1;u>0;u--){if(o<=t.settings.zLie){if(e("#div_"+u+"_"+o+"_"+i).css("display")!="block")break;s++}o++}return s},whoWin:function(e,t){return e.times>=e.settings.wzNum-1?(t=="b"?(alert("!黑子胜出!"),confirm("再来一局吗?")&&window.location.reload()):(alert("!白子胜出!"),confirm("再来一局吗?")&&window.location.reload()),!0):!1},reGame:function(){confirm("重新开始一局吗?")&&window.location.reload()}}})(jQuery)